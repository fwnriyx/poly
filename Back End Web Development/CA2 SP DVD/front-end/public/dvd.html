<!DOCTYPE html>
<html lang="en">

<head>
    <title>SP DVD | Home</title>
    <link href="css/dvd.css" rel="stylesheet">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
        integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.1/css/all.css"
        integrity="sha384-gfdkjb5BdAXd+lj+gudLWI+BXq4IuLW5IT+brZEZsLFm++aCMlF1V92rMkPaX4PP" crossorigin="anonymous">

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!-- Popper JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</head>

<body>
    <!--navigation tab-->
    <nav class="navbar navbar-expand-lg bg-dark navbar-dark">
        <a class="navbar-brand" href="#"><b class="text-danger">SP DVD</b></a>

        <div class="collapse navbar-collapse" id="navbarTogglerDemo02">
            <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
                <li class="nav-item">
                    <a class="nav-link" href="index.html">Home</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="DVD.html">Products</a>
                </li>
                <li class="nav-item" id="adminF"></li>
            </ul>
            <ul class="navbar-nav ml-auto mt-2 mt-lg-0 pr-3">
                <li class="nav-item" id="logInOut">
                </li>
            </ul>
        </div>
    </nav>
    <table class="container" id="film-table">
        <thead>
            <tr>
                <th>
                    <h1>Title</h1>
                </th>
                <th>
                    <h1>Release Year</h1>
                </th>
                <th>
                    <h1>Description</h1>
                </th>
                <th>
                    <h1>Rating</h1>
                </th>
                <th>
                    <h1>Actors</h1>
                </th>
            </tr>
        </thead>
        <tbody id="film-table-body">
        </tbody>
    </table>
    <script>
        $(document).ready(function () {
            var film_id = localStorage.getItem("film_id");
            if (film_id) {
                console.log("Retrieved film id from localStorage:", film_id);
                // Fetch the film data using AJAX
                $.ajax({
                    url: `http://localhost:3000/DVD/${localStorage.getItem("film_id")}`,
                    type: "GET",
                    success: function (result) {
                        console.log("Film details:", result);
                        var film = result[0]['first_name'];
                        console.log(film)
                        names = ""
                        for (let i = 0; i < result.length; i++) {
                            names += result[i]['first_name'] + " " + result[i]['last_name'] + ", \n";
                            console.log(names)
                        }
                        names = names.substring(0, names.length - 1);
                        console.log(names);
                        $("#title").text(result[0]['title']);
                        $("#release_year").text(result[0]['release_year']);
                        $("#description").text(result[0]['description']);
                        $("#rating").text(result[0]['rating']);
                        $("#film-table-body").append(`
                    <tr>
                        <td>${result[0]['title']}</td>
                        <td>${result[0]['release_year']}</td>
                        <td>${result[0]['description']}</td>
                        <td>${result[0]['rating']}</td>
                        <td>${names}</td>
                    </tr>
                `);
                    }
                    ,
                    error: function (xhr, status, error) {
                        console.error("Error fetching data from server:", error);
                    }
                });
            }
        });

    </script>
        <!--Check user login-->
        <script>
            var login = false
            $(document).ready(function () {
                if (localStorage.getItem('token')) {
                    var login = true
                    console.log(localStorage.getItem('token'))
                    document.getElementById("logInOut").innerHTML = `<a role="button" name="button" class="btn btn-danger" href="#" id="logout">Log Out</a>`
                } else {
                    console.log("not logged in")
                    document.getElementById("logInOut").innerHTML = `<a role="button" name="button" class="btn btn-primary" href="./login.html" id="login">Admin Login</a>`
                }
            })
        </script>
        <!--Logout function-->
        <script>
            $(document).ready(function () {
                $("#logout").click(function () {
                    localStorage.removeItem("token");
                    localStorage.removeItem("staff_id");
                    window.location.assign("/");
                })
            })
        </script>
        <!--Accessing admin page-->
        <script>
            $(document).ready(function () {
                if (localStorage.getItem('token')) {
                    console.log(localStorage.getItem('token'))
                    document.getElementById("adminF").innerHTML = `<a class="nav-link" id="adminf" href="./add.html">Admin</a>`
                } else {
                    console.log("not logged in")
                    document.getElementById("adminF").innerHTML = `<a class="nav-link" id="adminf" href="./login.html">Admin</a>`
                }
            })
        </script>
</body>

</html>